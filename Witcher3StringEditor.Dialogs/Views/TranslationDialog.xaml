<Window
    x:Class="Witcher3StringEditor.Dialogs.Views.TranslationDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:i18n="clr-namespace:System.Windows;assembly=Antelcat.I18N.WPF"
    xmlns:l="clr-namespace:Witcher3StringEditor.Locales;assembly=Witcher3StringEditor.Locales"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.inkore.net/lib/ui/wpf/modern"
    xmlns:vm="clr-namespace:Witcher3StringEditor.Dialogs.ViewModels"
    xmlns:t="clr-namespace:Witcher3StringEditor.Dialogs.TemplateSelectors"
    Title="{Binding Title}"
    Width="800"
    Height="800"
    d:DataContext="{d:DesignInstance Type=vm:TranslationDialogViewModel}"
    ui:TitleBar.ExtendViewIntoTitleBar="True"
    ui:WindowHelper.SystemBackdropType="Mica"
    ui:WindowHelper.UseModernWindowStyle="True"
    Closed="Window_Closed"
    WindowChrome.IsHitTestVisibleInChrome="True"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">
    <!-- 
        Interaction triggers for handling window events
        Binds window events to corresponding commands in the view model
    -->
    <i:Interaction.Triggers>
        <!-- Trigger for the Closing event -->
        <i:EventTrigger EventName="Closing">
            <i:InvokeCommandAction Command="{Binding ClosingCommand}" PassEventArgsToCommand="True" />
        </i:EventTrigger>
        <!-- Trigger for the Closed event -->
        <i:EventTrigger EventName="Closed">
            <i:InvokeCommandAction Command="{Binding ClosedCommand}" />
        </i:EventTrigger>
        <!-- Trigger for the Loaded event -->
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding DetectLanguageCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <!-- 
        Window resources containing data templates and template selector
    -->
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- Include batch translate data template -->
                <ResourceDictionary
                    Source="/Witcher3StringEditor.Dialogs;component/Views/BatchTranslateDataTemplate.xaml" />
                <!-- Include single item translate data template -->
                <ResourceDictionary Source="/Witcher3StringEditor.Dialogs;component/Views/TranslateDataTemplate.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <!-- Template selector to choose between single and batch translation views -->
            <t:TranslationViewTemplateSelector
                x:Key="TranslationViewTemplateSelector"
                BatchTranslateDataTemplate="{StaticResource BatchTranslateDataTemplate}"
                TranslateDataTemplate="{StaticResource TranslateDataTemplate}" />
        </ResourceDictionary>
    </Window.Resources>
    <!-- 
        Main grid layout for the translation dialog
        Contains two rows: title bar and content area
    -->
    <Grid>
        <Grid.RowDefinitions>
            <!-- Title bar row -->
            <RowDefinition Height="48" />
            <!-- Content area row -->
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <!-- Title text displayed in the title bar area -->
        <StackPanel Margin="20,0,0,0" VerticalAlignment="Center">
            <TextBlock Text="{Binding Title}" />
            <TextBlock
                FontSize="12"
                Opacity="0.7"
                Text="{Binding ActiveEngineLabel}" />
            <TextBlock
                FontSize="11"
                Opacity="0.6"
                Text="{Binding SelectedProviderSummary}"
                TextTrimming="CharacterEllipsis" />
            <TextBlock
                FontSize="11"
                Opacity="0.55"
                Text="{Binding ProviderReadinessStatus}"
                TextTrimming="CharacterEllipsis" />
            <TextBlock
                FontSize="11"
                Opacity="0.6"
                Text="{Binding CurrentViewModel.LastProviderError}"
                TextTrimming="CharacterEllipsis" />
            <StackPanel Orientation="Horizontal">
                <TextBlock
                    Margin="0,0,8,0"
                    FontSize="11"
                    Opacity="0.7"
                    Text="{i18n:I18N Key=TranslationModeLabel}" />
                <ComboBox
                    MinWidth="160"
                    FontSize="11"
                    ItemsSource="{Binding TranslationModes}"
                    SelectedItem="{Binding TranslationMode, Mode=TwoWay}"
                    Opacity="0.7" />
            </StackPanel>
        </StackPanel>
        <!-- Content grid containing the switch button and translation view -->
        <Grid Grid.Row="1" Margin="24,16,24,16">
            <Grid.RowDefinitions>
                <!-- Provider readiness banner row -->
                <RowDefinition Height="Auto" />
                <!-- Switch mode button row -->
                <RowDefinition Height="Auto" />
                <!-- Translation view content row -->
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <ui:InfoBar
                Grid.Row="0"
                Margin="0,0,0,12"
                IsOpen="{Binding IsProviderReadinessBannerVisible}"
                Message="{Binding ProviderReadinessMessage}" />
            <!-- Button to switch between single and batch translation modes -->
            <Button
                Grid.Row="1"
                Margin="0,0,0,16"
                HorizontalAlignment="Right"
                Command="{Binding SwitchCommand}">
                <ui:FontIcon Glyph="&#xE8AB;" />
            </Button>
            <!-- Content control that displays the appropriate translation view based on the current view model -->
            <ContentControl
                Grid.Row="2"
                Content="{Binding CurrentViewModel}"
                ContentTemplateSelector="{StaticResource TranslationViewTemplateSelector}" />
        </Grid>
    </Grid>
</Window>
